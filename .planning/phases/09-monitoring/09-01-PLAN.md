---
phase: 09-monitoring
plan: 01
type: execute
depends_on: []
files_modified: [src/monitor/types.ts, src/monitor/executions.ts, src/monitor/index.ts]
---

<objective>
모니터링 모듈의 기본 구조와 실행 상태 조회 API를 구현합니다.

Purpose: 워크플로우 실행 상태를 프로그래밍 방식으로 조회하는 기반 제공
Output: monitor 모듈 (types, executions 함수)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./09-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# 참조 파일:
@src/api/client.ts (N8nApiClient - getExecutions, getExecution)
@src/types/n8n.ts (N8nExecution, N8nExecutionStatus, N8nExecutionMode)
@src/backup/backup.ts (모듈 패턴 참조)

**기술 스택:**
- TypeScript 5.x, ES Modules
- N8nApiClient API 클라이언트
- native fetch

**배경:**
- Phase 2에서 n8n API 클라이언트 구현 완료
- N8nApiClient.getExecutions() 이미 구현됨
- 모니터링 모듈은 이를 래핑하여 더 풍부한 기능 제공

**결정 사항:**
- src/monitor/ 디렉토리 신규 생성
- 기존 N8nApiClient 재사용
- 실행 상태 필터링/집계 기능 추가
</context>

<tasks>

<task type="auto">
  <name>Task 1: 모니터링 타입 정의</name>
  <files>src/monitor/types.ts</files>
  <action>
src/monitor/types.ts 생성:

1. ExecutionFilter 인터페이스:
   - workflowId?: string (특정 워크플로우)
   - status?: N8nExecutionStatus | N8nExecutionStatus[] (상태 필터)
   - startedAfter?: Date (시작 시간 이후)
   - startedBefore?: Date (시작 시간 이전)
   - limit?: number (최대 개수)

2. ExecutionSummary 인터페이스:
   - total: number
   - success: number
   - error: number
   - running: number
   - waiting: number

3. WorkflowExecutionStats 인터페이스:
   - workflowId: string
   - workflowName: string
   - totalExecutions: number
   - successRate: number (0-100)
   - avgDuration?: number (ms)
   - lastExecution?: Date
   - lastStatus?: N8nExecutionStatus

4. MonitoringResult 인터페이스:
   - executions: N8nExecution[]
   - summary: ExecutionSummary
   - fetchedAt: Date
  </action>
  <verify>npm run build 성공</verify>
  <done>모니터링 타입 정의 완료</done>
</task>

<task type="auto">
  <name>Task 2: 실행 조회 함수 구현</name>
  <files>src/monitor/executions.ts</files>
  <action>
src/monitor/executions.ts 생성:

1. import 문:
   - N8nApiClient from '../api/index.js'
   - 타입들 from './types.js'
   - N8nExecution, N8nExecutionStatus from '../types/n8n.js'

2. getExecutions(client, filter?) 함수:
   - N8nApiClient.getExecutions() 호출
   - filter가 있으면 결과 필터링:
     * workflowId 일치
     * status 일치 (배열이면 includes)
     * startedAfter 이후
     * startedBefore 이전
   - limit 적용
   - 결과 반환

3. getExecutionsSummary(executions) 함수:
   - 실행 배열을 받아 ExecutionSummary 계산
   - total, success, error, running, waiting 카운트

4. fetchMonitoringData(client, filter?) 함수:
   - getExecutions 호출
   - getExecutionsSummary로 요약 생성
   - MonitoringResult 반환

5. getWorkflowStats(client, workflowId, limit?) 함수:
   - 특정 워크플로우의 실행 통계 계산
   - WorkflowExecutionStats 반환
   - 성공률, 평균 실행시간, 마지막 실행 정보
  </action>
  <verify>npm run build 성공</verify>
  <done>실행 조회 함수 구현 완료</done>
</task>

<task type="auto">
  <name>Task 3: 모듈 인덱스 및 내보내기</name>
  <files>src/monitor/index.ts</files>
  <action>
src/monitor/index.ts 생성:

1. types.ts에서 모든 타입 re-export
2. executions.ts에서 모든 함수 re-export:
   - getExecutions
   - getExecutionsSummary
   - fetchMonitoringData
   - getWorkflowStats

export * from './types.js';
export * from './executions.js';
  </action>
  <verify>npm run build 성공</verify>
  <done>모듈 인덱스 완성</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] src/monitor/ 디렉토리 생성됨
- [ ] types.ts에 모니터링 타입 정의됨
- [ ] executions.ts에 조회 함수 구현됨
- [ ] index.ts에서 모든 내보내기 완료
</verification>

<success_criteria>
- 모니터링 타입 체계 확립
- 실행 조회 및 필터링 함수 제공
- 실행 요약 통계 계산 기능
- 워크플로우별 통계 조회 기능
</success_criteria>

<output>
완료 후 `.planning/phases/09-monitoring/09-01-SUMMARY.md` 생성
</output>
