---
phase: 09-monitoring
plan: 02
type: execute
depends_on: ["09-01"]
files_modified: [src/cli/commands/monitor.ts, src/cli/commands/index.ts]
---

<objective>
모니터링 CLI 명령어를 구현합니다.

Purpose: 명령줄에서 워크플로우 실행 상태를 조회하고 대시보드 형태로 출력
Output: monitor 명령어 그룹 (monitor, monitor status, monitor workflow)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./09-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-monitoring/09-01-PLAN.md

# 참조 파일:
@src/cli/commands/status.ts (CLI 명령어 패턴)
@src/cli/commands/backup.ts (서브커맨드 패턴)
@src/monitor/index.ts

**기술 스택:**
- TypeScript 5.x, ES Modules
- Commander.js CLI 프레임워크
- chalk 컬러 출력

**배경:**
- 09-01에서 모니터링 모듈 완료
- CLI에서 실행 상태를 시각적으로 표시
- 대시보드 형태의 요약 정보 제공
</context>

<tasks>

<task type="auto">
  <name>Task 1: monitor 기본 명령어</name>
  <files>src/cli/commands/monitor.ts</files>
  <action>
src/cli/commands/monitor.ts 생성:

1. import 문:
   - commander (Command)
   - chalk
   - 설정 로더 (loadConfig, getCurrentEnvironment)
   - API 클라이언트 (createClientFromConfig)
   - 모니터링 모듈 (fetchMonitoringData, getWorkflowStats)

2. registerMonitorCommand(program: Command): void

3. monitor 명령어 (기본):
   - `monitor`
   - 설명: "워크플로우 실행 상태 모니터링"
   - 옵션:
     * `-c, --config <path>`: 설정 파일 경로
     * `-e, --env <name>`: 환경 지정
     * `-l, --limit <n>`: 표시할 최근 실행 개수 (기본: 20)
     * `-s, --status <status>`: 상태 필터 (success, error, running)
   - 출력 형식 (대시보드):
     ```
     === n8n Workflow Monitor ===
     Environment: development

     Summary:
       Total: 150   Success: 120   Error: 25   Running: 5
       Success Rate: 80%

     Recent Executions:
       ID        Workflow          Status    Started              Duration
       -------   --------------    ------    ------------------   --------
       1234      My Workflow       success   2024-01-15 10:30     2.5s
       1233      Other WF          error     2024-01-15 10:28     1.2s
       ...
     ```

4. formatDuration(startedAt, stoppedAt) 헬퍼:
   - 실행 시간을 사람이 읽기 쉬운 형식으로
   - 예: "2.5s", "1m 30s", "running"

5. formatStatus(status) 헬퍼:
   - chalk로 상태별 색상 적용
   - success: green, error: red, running: yellow
  </action>
  <verify>npm run build 성공</verify>
  <done>monitor 기본 명령어 완료</done>
</task>

<task type="auto">
  <name>Task 2: monitor workflow 서브커맨드</name>
  <files>src/cli/commands/monitor.ts</files>
  <action>
src/cli/commands/monitor.ts에 추가:

1. monitor workflow 서브커맨드:
   - `monitor workflow <workflow-id>`
   - 설명: "특정 워크플로우의 실행 통계"
   - 옵션:
     * `-c, --config <path>`: 설정 파일 경로
     * `-e, --env <name>`: 환경 지정
     * `-l, --limit <n>`: 분석할 실행 개수 (기본: 100)

   - 출력 형식:
     ```
     === Workflow Stats ===
     Workflow: My Workflow (id: abc123)

     Statistics (last 100 executions):
       Total Executions: 100
       Success Rate: 85%
       Average Duration: 3.2s
       Last Execution: 2024-01-15 10:30
       Last Status: success

     Status Distribution:
       Success: ████████████████░░░░ 85
       Error:   ████░░░░░░░░░░░░░░░░ 10
       Other:   █░░░░░░░░░░░░░░░░░░░ 5
     ```

2. printProgressBar(value, max, width) 헬퍼:
   - 간단한 ASCII 프로그레스 바
   - 예: ████████░░░░░░░░░░░░ 50%
  </action>
  <verify>npm run build 성공</verify>
  <done>monitor workflow 서브커맨드 완료</done>
</task>

<task type="auto">
  <name>Task 3: CLI 통합 및 검증</name>
  <files>src/cli/commands/index.ts</files>
  <action>
1. src/cli/commands/index.ts 수정:
   - import { registerMonitorCommand } from './monitor.js'
   - registerMonitorCommand(program) 호출 추가

2. 빌드 검증

3. CLI 명령어 테스트:
   - node dist/index.js monitor --help
   - node dist/index.js monitor workflow --help

4. 도움말 텍스트 확인:
   - 명령어 설명 명확한지
   - 옵션 설명 충분한지
  </action>
  <verify>
npm run build 성공
node dist/index.js monitor --help 정상 출력
node dist/index.js monitor workflow --help 정상 출력
  </verify>
  <done>모니터링 CLI 통합 완료</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] `n8n-wfm monitor` 명령어 동작
- [ ] `n8n-wfm monitor workflow <id>` 명령어 동작
- [ ] 대시보드 형식 출력 확인
- [ ] 상태별 색상 구분 확인
</verification>

<success_criteria>
- 직관적인 모니터링 CLI 인터페이스
- 대시보드 형태의 요약 정보
- 워크플로우별 상세 통계
- 시각적으로 읽기 쉬운 출력
</success_criteria>

<output>
완료 후 `.planning/phases/09-monitoring/09-02-SUMMARY.md` 생성
</output>
