---
phase: 09-monitoring
plan: 03
type: execute
depends_on: ["09-01"]
files_modified: [src/cli/commands/monitor.ts]
---

<objective>
실행 이력 조회 서브커맨드를 구현합니다.

Purpose: 특정 실행의 상세 정보를 조회하고, 실행 이력을 검색
Output: monitor history, monitor execution 서브커맨드
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./09-03-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-monitoring/09-01-PLAN.md
@.planning/phases/09-monitoring/09-02-PLAN.md

# 참조 파일:
@src/cli/commands/monitor.ts (09-02에서 생성된 파일)
@src/monitor/index.ts
@src/api/client.ts (getExecution 메서드)

**기술 스택:**
- TypeScript 5.x, ES Modules
- Commander.js CLI 프레임워크
- chalk 컬러 출력

**배경:**
- 09-01에서 모니터링 모듈 완료
- 09-02에서 기본 monitor 명령어 완료
- 실행 이력 상세 조회 기능 추가
</context>

<tasks>

<task type="auto">
  <name>Task 1: monitor history 서브커맨드</name>
  <files>src/cli/commands/monitor.ts</files>
  <action>
src/cli/commands/monitor.ts에 추가:

1. monitor history 서브커맨드:
   - `monitor history`
   - 설명: "워크플로우 실행 이력 검색"
   - 옵션:
     * `-c, --config <path>`: 설정 파일 경로
     * `-e, --env <name>`: 환경 지정
     * `-w, --workflow <id>`: 워크플로우 ID로 필터
     * `-s, --status <status>`: 상태로 필터 (success, error, running)
     * `--since <date>`: 시작 날짜 이후 (YYYY-MM-DD)
     * `--until <date>`: 종료 날짜 이전 (YYYY-MM-DD)
     * `-l, --limit <n>`: 결과 개수 (기본: 50)

   - 출력 형식:
     ```
     === Execution History ===
     Filter: workflow=abc123, status=error, since=2024-01-01

     Found 15 executions:
       ID        Workflow          Status    Started              Duration
       -------   --------------    ------    ------------------   --------
       1234      My Workflow       error     2024-01-15 10:30     2.5s
       1230      My Workflow       error     2024-01-14 15:20     1.8s
       ...

     Use 'n8n-wfm monitor execution <id>' for details
     ```

2. parseDate(dateStr) 헬퍼:
   - YYYY-MM-DD 또는 YYYY-MM-DDTHH:mm:ss 파싱
   - 유효하지 않으면 undefined 반환
  </action>
  <verify>npm run build 성공</verify>
  <done>monitor history 서브커맨드 완료</done>
</task>

<task type="auto">
  <name>Task 2: monitor execution 서브커맨드</name>
  <files>src/cli/commands/monitor.ts</files>
  <action>
src/cli/commands/monitor.ts에 추가:

1. monitor execution 서브커맨드:
   - `monitor execution <execution-id>`
   - 설명: "특정 실행의 상세 정보 조회"
   - 옵션:
     * `-c, --config <path>`: 설정 파일 경로
     * `-e, --env <name>`: 환경 지정
     * `--show-data`: 실행 데이터 표시 (기본: 숨김)

   - 출력 형식:
     ```
     === Execution Details ===
     ID: 1234
     Workflow: My Workflow (abc123)

     Status: error
     Mode: webhook

     Started: 2024-01-15 10:30:15
     Stopped: 2024-01-15 10:30:18
     Duration: 2.5s

     [Error Details]
     Node: HTTP Request
     Message: Connection refused

     [Execution Data] (--show-data로 표시)
     { ... }
     ```

2. formatExecutionDetails(execution) 헬퍼:
   - 실행 상세 정보를 포맷팅
   - 에러 시 에러 정보 추출 및 표시
  </action>
  <verify>npm run build 성공</verify>
  <done>monitor execution 서브커맨드 완료</done>
</task>

<task type="auto">
  <name>Task 3: 통합 검증</name>
  <files>src/cli/commands/monitor.ts</files>
  <action>
1. 빌드 검증:
   - npm run build

2. CLI 명령어 테스트:
   - node dist/index.js monitor history --help
   - node dist/index.js monitor execution --help

3. 도움말 텍스트 확인:
   - 모든 monitor 서브커맨드 나열 확인
   - 옵션 설명 충분한지 확인
  </action>
  <verify>
npm run build 성공
node dist/index.js monitor history --help 정상 출력
node dist/index.js monitor execution --help 정상 출력
  </verify>
  <done>실행 이력 조회 명령어 통합 완료</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] `n8n-wfm monitor history` 명령어 동작
- [ ] `n8n-wfm monitor execution <id>` 명령어 동작
- [ ] 날짜 필터링 동작 확인
- [ ] 상태별 필터링 동작 확인
</verification>

<success_criteria>
- 실행 이력 검색 기능
- 개별 실행 상세 조회
- 다양한 필터 옵션 지원
- 에러 정보 명확한 표시
</success_criteria>

<output>
완료 후 `.planning/phases/09-monitoring/09-03-SUMMARY.md` 생성
</output>
