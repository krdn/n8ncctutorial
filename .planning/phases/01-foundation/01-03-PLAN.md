---
phase: 01-foundation
plan: 03
type: execute
depends_on: ["01-01"]
files_modified: [src/config/index.ts, src/config/schema.ts, src/types/config.ts, config.example.yaml]
---

<objective>
설정 파일 구조 정의

Purpose: n8n 인스턴스 연결 정보와 환경 설정을 관리하는 설정 시스템 구축
Output: 설정 스키마, 로더, 기본 설정 파일 템플릿
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

**Tech stack available:**
- TypeScript 5.x (ES Modules)
- Node.js 20+

**Project constraints:**
- 다중 환경 지원 필요 (dev/staging/prod)
- n8n API URL과 API Key 관리
- YAML 형식 선호 (가독성)
</context>

<tasks>

<task type="auto">
  <name>Task 1: 설정 타입 정의</name>
  <files>src/types/config.ts</files>
  <action>
src/types/config.ts 생성:

interface N8nInstanceConfig {
  url: string;          // n8n API URL
  apiKey: string;       // API Key (환경변수 참조 가능)
}

interface EnvironmentConfig {
  name: string;         // 환경 이름 (dev, staging, prod)
  n8n: N8nInstanceConfig;
  isDefault?: boolean;
}

interface Config {
  version: string;
  currentEnvironment: string;
  environments: EnvironmentConfig[];
  backup?: {
    directory: string;
    retention: number;  // 일 단위
  };
}

export type { Config, EnvironmentConfig, N8nInstanceConfig };
  </action>
  <verify>npm run build (타입 에러 없음)</verify>
  <done>설정 타입 정의됨, 빌드 성공</done>
</task>

<task type="auto">
  <name>Task 2: 설정 로더 구현</name>
  <files>src/config/index.ts, src/config/schema.ts</files>
  <action>
yaml 패키지 설치 (npm install yaml)

src/config/schema.ts:
- Zod 또는 간단한 검증 함수로 설정 검증
- 필수 필드 확인, 기본값 적용

src/config/index.ts:
- loadConfig(configPath?: string): Config
- 기본 경로: ~/.n8n-wfm/config.yaml 또는 ./n8n-wfm.config.yaml
- 파일 없으면 에러 메시지와 함께 예제 설정 안내
- 환경변수 치환 지원: ${N8N_API_KEY} 형태
  </action>
  <verify>npm run build</verify>
  <done>설정 로더 함수 구현됨, YAML 파싱 가능</done>
</task>

<task type="auto">
  <name>Task 3: 예제 설정 파일 생성</name>
  <files>config.example.yaml</files>
  <action>
config.example.yaml 생성:

```yaml
version: "1"
currentEnvironment: dev

environments:
  - name: dev
    isDefault: true
    n8n:
      url: http://localhost:5678
      apiKey: ${N8N_DEV_API_KEY}

  - name: staging
    n8n:
      url: https://n8n-staging.example.com
      apiKey: ${N8N_STAGING_API_KEY}

  - name: prod
    n8n:
      url: https://n8n.example.com
      apiKey: ${N8N_PROD_API_KEY}

backup:
  directory: ./backups
  retention: 30
```

README나 설정 안내에 사용될 예제 파일
  </action>
  <verify>cat config.example.yaml</verify>
  <done>예제 설정 파일 생성됨, YAML 문법 유효</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] 설정 타입 정의됨
- [ ] 설정 로더 함수 구현됨
- [ ] config.example.yaml 생성됨
</verification>

<success_criteria>
- 모든 태스크 완료
- 설정 시스템 기반 구조 완성
- 다중 환경 설정 지원 준비됨
- Phase 1 완료
</success_criteria>

<output>
완료 후 `.planning/phases/01-foundation/01-03-SUMMARY.md` 생성

Phase 1 완료 시 SUMMARY에 "Phase 1 complete, ready for Phase 2" 명시
</output>
