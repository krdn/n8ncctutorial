---
phase: 03-workflow-export-import
plan: 02
type: execute
depends_on: []
files_modified: [src/workflow/import.ts, src/workflow/index.ts, src/cli/commands/import.ts, src/cli/commands/index.ts]
---

<objective>
워크플로우 가져오기 기능 구현

Purpose: JSON 파일에서 워크플로우를 n8n 인스턴스로 가져오기 (새로 생성 또는 업데이트)
Output: import 모듈, CLI import 명령어
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-api-integration/02-03-SUMMARY.md

@src/api/client.ts
@src/types/n8n.ts

**Tech stack available:**
- N8nApiClient: createWorkflow(), updateWorkflow(), getWorkflows()
- N8nWorkflowDetail 타입
- Commander.js CLI 프레임워크

**Project constraints:**
- 기존 워크플로우와 이름 충돌 시 처리 옵션 필요
- JSON 파일 유효성 검증
</context>

<tasks>

<task type="auto">
  <name>Task 1: Import 모듈 구현</name>
  <files>src/workflow/import.ts, src/workflow/index.ts</files>
  <action>
src/workflow/import.ts 생성:

1. ImportOptions 인터페이스:
   - mode: 'create' | 'update' | 'upsert' (기본: 'create')
   - activate: boolean (가져온 후 활성화, 기본 false)

2. ImportResult 인터페이스:
   - workflowId: string
   - workflowName: string
   - action: 'created' | 'updated' | 'skipped'
   - success: boolean
   - error?: string

3. validateWorkflowJson(data: unknown): N8nWorkflowDetail | null
   - 필수 필드 검증: name, nodes, connections
   - 유효하면 타입 캐스팅 후 반환
   - 유효하지 않으면 null

4. importWorkflow(client: N8nApiClient, filePath: string, options: ImportOptions): Promise<ImportResult>
   - fs.readFileSync로 파일 읽기
   - JSON.parse 및 validateWorkflowJson()
   - mode에 따라:
     - create: createWorkflow() 호출
     - update: id로 기존 워크플로우 찾아 updateWorkflow()
     - upsert: 이름으로 기존 찾으면 update, 없으면 create
   - activate true면 activateWorkflow() 호출
   - 결과 반환

5. findWorkflowByName(client: N8nApiClient, name: string): Promise<N8nWorkflow | null>
   - getAllWorkflows() 호출
   - 이름으로 검색

src/workflow/index.ts 업데이트:
- import 모듈 re-export 추가
  </action>
  <verify>npm run build</verify>
  <done>import 모듈 구현됨, 검증 로직 포함</done>
</task>

<task type="auto">
  <name>Task 2: CLI import 명령어 구현</name>
  <files>src/cli/commands/import.ts, src/cli/commands/index.ts</files>
  <action>
src/cli/commands/import.ts 생성:

registerImportCommand(program: Command) 함수:

명령어: import <file>
설명: JSON 파일에서 워크플로우 가져오기

옵션:
- -e, --env <name>: 환경 지정
- -m, --mode <mode>: 가져오기 모드 (create/update/upsert, 기본: create)
- --activate: 가져온 후 활성화

동작:
1. 파일 존재 확인
2. 설정 파일 로드 및 환경 선택
3. N8nApiClient 생성
4. importWorkflow() 호출
5. 결과 출력:
   ```
   ✓ Imported: My Workflow
     Action: created
     ID: abc123
   ```

에러 처리:
- 파일 없음: "File not found: {path}"
- 잘못된 JSON: "Invalid JSON file"
- 잘못된 워크플로우 구조: "Invalid workflow format: missing {field}"

src/cli/commands/index.ts 수정:
- registerImportCommand import 및 등록
  </action>
  <verify>npm run build && node dist/index.js import --help</verify>
  <done>import 명령어 구현됨, --help 출력 확인</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] `node dist/index.js import --help` 도움말 표시
- [ ] import 모듈 타입 정의됨
- [ ] validateWorkflowJson 함수 구현됨
</verification>

<success_criteria>
- 모든 태스크 완료
- import 모듈로 JSON에서 워크플로우 생성 가능
- CLI import 명령어 작동
- 03-01과 독립적으로 실행 가능
</success_criteria>

<output>
완료 후 `.planning/phases/03-workflow-export-import/03-02-SUMMARY.md` 생성
</output>
