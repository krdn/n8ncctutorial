---
phase: 03-workflow-export-import
plan: 01
type: execute
depends_on: []
files_modified: [src/workflow/export.ts, src/workflow/index.ts, src/cli/commands/export.ts, src/cli/commands/index.ts]
---

<objective>
워크플로우 내보내기 기능 구현

Purpose: n8n 워크플로우를 JSON 파일로 내보내어 버전 관리, 백업, 환경 간 이동에 활용
Output: export 모듈, CLI export 명령어
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-api-integration/02-03-SUMMARY.md

@src/api/client.ts
@src/types/n8n.ts

**Tech stack available:**
- N8nApiClient: getWorkflow(), getAllWorkflows()
- N8nWorkflowDetail 타입 (nodes, connections, settings 포함)
- Commander.js CLI 프레임워크

**Project constraints:**
- 민감한 credentials는 내보내기 시 제거 또는 마스킹 옵션
- JSON 파일은 pretty-print 포맷
</context>

<tasks>

<task type="auto">
  <name>Task 1: Export 모듈 구현</name>
  <files>src/workflow/export.ts, src/workflow/index.ts</files>
  <action>
src/workflow/export.ts 생성:

1. ExportOptions 인터페이스:
   - outputDir: string (출력 디렉토리)
   - stripCredentials: boolean (credentials 제거 여부, 기본 true)
   - prettyPrint: boolean (JSON 포맷팅, 기본 true)

2. ExportResult 인터페이스:
   - workflowId: string
   - workflowName: string
   - filePath: string
   - success: boolean
   - error?: string

3. exportWorkflow(client: N8nApiClient, id: string, options: ExportOptions): Promise<ExportResult>
   - getWorkflow(id)로 상세 정보 조회
   - stripCredentials true면 nodes[].credentials 제거
   - 파일명: {workflowName}_{id}.json (특수문자 제거)
   - fs.writeFileSync로 저장
   - 성공/실패 결과 반환

4. sanitizeFilename(name: string): string
   - 파일명으로 사용 불가한 문자 제거/치환
   - 공백은 언더스코어로, 특수문자 제거

src/workflow/index.ts 생성:
- export 모듈 re-export
  </action>
  <verify>npm run build</verify>
  <done>export 모듈 구현됨, 타입 정의됨</done>
</task>

<task type="auto">
  <name>Task 2: CLI export 명령어 구현</name>
  <files>src/cli/commands/export.ts, src/cli/commands/index.ts</files>
  <action>
src/cli/commands/export.ts 생성:

registerExportCommand(program: Command) 함수:

명령어: export <workflow-id>
설명: 워크플로우를 JSON 파일로 내보내기

옵션:
- -o, --output <dir>: 출력 디렉토리 (기본: ./exports)
- -e, --env <name>: 환경 지정
- --keep-credentials: credentials 유지 (기본: 제거)

동작:
1. 설정 파일 로드 및 환경 선택
2. N8nApiClient 생성
3. exportWorkflow() 호출
4. 결과 출력:
   ```
   ✓ Exported: My Workflow
     File: ./exports/My_Workflow_abc123.json
   ```

에러 처리:
- 워크플로우 없음: "Workflow not found: {id}"
- 디렉토리 생성 실패: 상세 에러 메시지

src/cli/commands/index.ts 수정:
- registerExportCommand import 및 등록
  </action>
  <verify>npm run build && node dist/index.js export --help</verify>
  <done>export 명령어 구현됨, --help 출력 확인</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] `node dist/index.js export --help` 도움말 표시
- [ ] export 모듈 타입 정의됨
- [ ] sanitizeFilename 함수 구현됨
</verification>

<success_criteria>
- 모든 태스크 완료
- export 모듈로 워크플로우 JSON 저장 가능
- CLI export 명령어 작동
- 03-02와 독립적으로 실행 가능
</success_criteria>

<output>
완료 후 `.planning/phases/03-workflow-export-import/03-01-SUMMARY.md` 생성
</output>
