---
phase: 03-workflow-export-import
plan: 03
type: execute
depends_on: ["03-01", "03-02"]
files_modified: [src/workflow/bulk.ts, src/workflow/index.ts, src/cli/commands/export.ts, src/cli/commands/import.ts]
---

<objective>
벌크 내보내기/가져오기 기능 구현

Purpose: 여러 워크플로우를 한 번에 내보내거나 가져오기, 전체 백업/복원 지원
Output: bulk 모듈, CLI bulk 명령어
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-workflow-export-import/03-01-SUMMARY.md
@.planning/phases/03-workflow-export-import/03-02-SUMMARY.md

@src/workflow/export.ts
@src/workflow/import.ts

**Tech stack available:**
- exportWorkflow(), ExportOptions, ExportResult
- importWorkflow(), ImportOptions, ImportResult
- N8nApiClient: getAllWorkflows()

**Project constraints:**
- 대량 작업 시 진행 상황 표시
- 일부 실패해도 나머지 계속 처리
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bulk 모듈 구현</name>
  <files>src/workflow/bulk.ts, src/workflow/index.ts</files>
  <action>
src/workflow/bulk.ts 생성:

1. BulkExportOptions extends ExportOptions:
   - filter?: (workflow: N8nWorkflow) => boolean (필터링 함수)

2. BulkExportResult 인터페이스:
   - total: number
   - succeeded: number
   - failed: number
   - results: ExportResult[]

3. exportAllWorkflows(client: N8nApiClient, options: BulkExportOptions): Promise<BulkExportResult>
   - getAllWorkflows()로 목록 조회
   - filter 있으면 적용
   - 각 워크플로우에 exportWorkflow() 호출
   - 실패해도 계속 진행 (결과에 기록)
   - 전체 결과 집계 후 반환

4. BulkImportOptions extends ImportOptions:
   - continueOnError: boolean (에러 시 계속, 기본 true)

5. BulkImportResult 인터페이스:
   - total: number
   - succeeded: number
   - failed: number
   - results: ImportResult[]

6. importAllWorkflows(client: N8nApiClient, directory: string, options: BulkImportOptions): Promise<BulkImportResult>
   - fs.readdirSync로 디렉토리 내 *.json 파일 목록
   - 각 파일에 importWorkflow() 호출
   - continueOnError true면 실패해도 계속
   - 전체 결과 집계 후 반환

src/workflow/index.ts 업데이트:
- bulk 모듈 re-export 추가
  </action>
  <verify>npm run build</verify>
  <done>bulk 모듈 구현됨, BulkExportResult/BulkImportResult 타입 정의됨</done>
</task>

<task type="auto">
  <name>Task 2: CLI export-all 명령어 추가</name>
  <files>src/cli/commands/export.ts</files>
  <action>
src/cli/commands/export.ts 수정:

기존 export 명령어 유지하고 export-all 서브 명령어 추가:

명령어: export-all
설명: 모든 워크플로우를 JSON 파일로 내보내기

옵션:
- -o, --output <dir>: 출력 디렉토리 (기본: ./exports)
- -e, --env <name>: 환경 지정
- --keep-credentials: credentials 유지
- --active-only: 활성화된 워크플로우만

동작:
1. 설정 로드 및 환경 선택
2. N8nApiClient 생성
3. exportAllWorkflows() 호출 (active-only면 filter 적용)
4. 진행 상황 및 결과 출력:
   ```
   Exporting workflows...
   ✓ My Workflow (1/5)
   ✓ Another Workflow (2/5)
   ✗ Failed Workflow (3/5) - Error message
   ...

   Export complete: 4 succeeded, 1 failed
   Output: ./exports/
   ```
  </action>
  <verify>npm run build && node dist/index.js export-all --help</verify>
  <done>export-all 명령어 구현됨</done>
</task>

<task type="auto">
  <name>Task 3: CLI import-all 명령어 추가</name>
  <files>src/cli/commands/import.ts</files>
  <action>
src/cli/commands/import.ts 수정:

기존 import 명령어 유지하고 import-all 서브 명령어 추가:

명령어: import-all <directory>
설명: 디렉토리의 모든 JSON 파일에서 워크플로우 가져오기

옵션:
- -e, --env <name>: 환경 지정
- -m, --mode <mode>: 가져오기 모드 (create/update/upsert, 기본: create)
- --activate: 가져온 후 활성화
- --stop-on-error: 에러 시 중단

동작:
1. 디렉토리 확인 및 JSON 파일 목록
2. 설정 로드 및 환경 선택
3. N8nApiClient 생성
4. importAllWorkflows() 호출
5. 진행 상황 및 결과 출력:
   ```
   Importing workflows from ./exports/...
   ✓ My Workflow (created) (1/5)
   ✓ Another Workflow (updated) (2/5)
   ✗ Invalid.json - Invalid workflow format
   ...

   Import complete: 4 succeeded, 1 failed
   ```
  </action>
  <verify>npm run build && node dist/index.js import-all --help</verify>
  <done>import-all 명령어 구현됨</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] `node dist/index.js export-all --help` 도움말 표시
- [ ] `node dist/index.js import-all --help` 도움말 표시
- [ ] bulk 모듈 타입 정의됨
- [ ] 진행 상황 표시 구현됨
</verification>

<success_criteria>
- 모든 태스크 완료
- bulk 모듈로 전체 워크플로우 내보내기/가져오기 가능
- CLI export-all, import-all 명령어 작동
- Phase 3 완료, Phase 4 준비됨
</success_criteria>

<output>
완료 후 `.planning/phases/03-workflow-export-import/03-03-SUMMARY.md` 생성

Phase 3 완료 시 SUMMARY에 "Phase 3 complete, ready for Phase 4" 명시
</output>
