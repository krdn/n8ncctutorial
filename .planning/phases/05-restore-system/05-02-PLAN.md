# Plan 05-02: 특정 백업 복원

## Overview
특정 백업 ID를 지정하여 해당 백업의 모든 워크플로우를 n8n 인스턴스로 복원하는 기능을 구현합니다. workflow/import.ts의 importWorkflow 함수를 활용합니다.

## Dependencies
- 05-01 완료 (restore 모듈 기본 구조, 백업 조회 기능)

## Tasks

<task id="1">
<title>복원 실행 모듈 구현</title>
<file>src/restore/restore.ts</file>
<action>create</action>
<description>
백업 복원 핵심 로직:
- restoreBackup(client, backupDir, options): 전체 백업 복원 수행
  - 매니페스트에서 워크플로우 목록 조회
  - 각 워크플로우 JSON 파일 읽기
  - importWorkflow 함수로 n8n에 가져오기
  - RestoreResult 반환 (성공/실패 목록)
- 옵션:
  - mode: 'create' | 'upsert' (기본: upsert)
  - activate: 복원 후 활성화 여부 (기본: false)
  - continueOnError: 에러 시 계속 진행 (기본: true)
- ProgressCallback 지원하여 진행 상황 알림
</description>
</task>

<task id="2">
<title>restore 타입 확장</title>
<file>src/restore/types.ts</file>
<action>modify</action>
<description>
RestoreOptions 타입 확장:
- mode: 가져오기 모드 ('create' | 'upsert')
- activate: 복원 후 활성화 여부
- continueOnError: 에러 시 계속 진행 여부
</description>
</task>

<task id="3">
<title>restore 모듈 인덱스 업데이트</title>
<file>src/restore/index.ts</file>
<action>modify</action>
<description>
restore.ts 함수 재내보내기 추가:
- restoreBackup
</description>
</task>

<task id="4">
<title>restore 명령어에 복원 기능 추가</title>
<file>src/cli/commands/restore.ts</file>
<action>modify</action>
<description>
restore 하위 명령어 추가:
- `n8n-wfm restore run <backupId>` - 백업 복원 실행
  - -e, --env <name>: 복원 대상 환경 지정
  - -c, --config <path>: 설정 파일 경로
  - --dir <path>: 백업 디렉토리 지정
  - --mode <mode>: 가져오기 모드 (create/upsert, 기본: upsert)
  - --activate: 복원 후 워크플로우 활성화
  - --dry-run: 실제 복원 없이 계획만 표시
- 진행 상황 출력 (✓ workflow name 형식)
- 완료 후 요약 출력 (성공/실패 개수)
</description>
</task>

<task id="5">
<title>빌드 및 CLI 검증</title>
<file>package.json</file>
<action>verify</action>
<description>
- npm run build 실행
- node dist/index.js restore run --help 실행
- --dry-run 옵션으로 복원 계획 확인
</description>
</task>

## Verification
- [ ] `npm run build` 성공
- [ ] `node dist/index.js restore run --help` 정상 출력
- [ ] restoreBackup 함수 구현 완료
- [ ] --dry-run 옵션으로 복원 대상 워크플로우 목록 확인
- [ ] 진행 상황 콜백 연동

## Notes
- workflow/import.ts의 importWorkflow를 활용하여 중복 구현 방지
- upsert 모드가 기본 - 기존 워크플로우가 있으면 업데이트, 없으면 생성
- credentials는 백업 시 제거되었으므로 복원 후 수동 설정 안내 필요
- dry-run은 실제 API 호출 없이 복원 계획만 출력
