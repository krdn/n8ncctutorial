---
phase: 07-environment-config
plan: 02
type: execute
depends_on: ["07-01"]
files_modified: [src/config/switch.ts, src/config/index.ts, src/cli/commands/env.ts, src/cli/index.ts]
---

<objective>
환경 전환 명령어를 구현하여 CLI에서 환경을 쉽게 변경할 수 있도록 합니다.

Purpose: 명령줄에서 개발/스테이징/프로덕션 환경 간 빠른 전환
Output: env 명령어 (list, use, current) 및 환경 전환 모듈
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./07-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-environment-config/07-01-PLAN.md

# 참조 파일:
@src/config/index.ts
@src/config/environment.ts (07-01에서 생성)
@src/cli/commands/config.ts

**기술 스택:**
- TypeScript 5.x, ES Modules
- Commander.js CLI 프레임워크
- YAML 라이브러리 (stringify)

**결정 사항:**
- `n8n-wfm env` 명령어 그룹 신설
- 환경 전환 시 설정 파일 직접 수정 (currentEnvironment 변경)
- 임시 전환 옵션 (--env 플래그로 일회성 환경 지정)
</context>

<tasks>

<task type="auto">
  <name>Task 1: 환경 전환 모듈 구현</name>
  <files>src/config/switch.ts</files>
  <action>
src/config/switch.ts 생성:

1. switchEnvironment(configPath, targetEnv): SwitchResult
   - 설정 파일 읽기
   - targetEnv 존재 여부 확인
   - currentEnvironment 값 변경
   - YAML로 파일 다시 저장
   - 변경 전/후 환경 이름 반환

2. SwitchResult 타입:
   - success: boolean
   - previousEnv: string
   - currentEnv: string
   - error?: string

3. validateEnvironmentSwitch(config, targetEnv): ValidationResult
   - 대상 환경 존재 여부 검증
   - 이미 현재 환경인 경우 알림
  </action>
  <verify>npm run build 성공</verify>
  <done>환경 전환 모듈 구현</done>
</task>

<task type="auto">
  <name>Task 2: env CLI 명령어 구현</name>
  <files>src/cli/commands/env.ts</files>
  <action>
src/cli/commands/env.ts 생성:

1. `n8n-wfm env list` - 환경 목록 표시
   - 모든 환경 목록 출력
   - 현재 환경 표시 (*)
   - description, URL 표시

2. `n8n-wfm env current` - 현재 환경 표시
   - 현재 활성 환경 이름 및 상세 정보

3. `n8n-wfm env use <name>` - 환경 전환
   - 대상 환경으로 전환
   - 전환 성공/실패 메시지
   - --config 옵션 지원

registerEnvCommand(program) 함수로 명령어 등록
  </action>
  <verify>
npm run build 성공
node dist/index.js env --help 출력 확인
  </verify>
  <done>env CLI 명령어 구현</done>
</task>

<task type="auto">
  <name>Task 3: CLI 인덱스 및 모듈 연동</name>
  <files>src/cli/index.ts, src/config/index.ts</files>
  <action>
1. src/cli/index.ts 수정:
   - registerEnvCommand import 추가
   - program에 env 명령어 등록

2. src/config/index.ts 수정:
   - switch.ts에서 함수 재내보내기:
     - switchEnvironment
     - validateEnvironmentSwitch
   - SwitchResult 타입 재내보내기

3. 빌드 및 기능 검증
  </action>
  <verify>
npm run build 성공
node dist/index.js env list 동작 확인
node dist/index.js env use --help 출력 확인
  </verify>
  <done>환경 전환 CLI 통합 완료</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] `node dist/index.js env list` 정상 출력
- [ ] `node dist/index.js env current` 정상 출력
- [ ] `node dist/index.js env use <name>` 환경 전환 동작
- [ ] 설정 파일에 currentEnvironment 값이 실제로 변경됨
</verification>

<success_criteria>
- env list/current/use 명령어 동작
- 환경 전환 시 설정 파일이 올바르게 업데이트됨
- 존재하지 않는 환경 전환 시 적절한 에러 메시지
- 빌드 성공
</success_criteria>

<output>
완료 후 `.planning/phases/07-environment-config/07-02-SUMMARY.md` 생성
</output>
