# Plan 04-01: 백업 저장소 구조 설계

## Overview
백업 시스템의 기반이 되는 저장소 구조를 설계하고 구현합니다. 타임스탬프 기반 백업 디렉토리 관리, 메타데이터 저장, 백업 매니페스트 파일 구조를 정의합니다.

## Dependencies
- Phase 3 완료 (export 기능 재사용)
- 없음 (Phase 4의 첫 번째 플랜)

## Tasks

<task id="1">
<title>백업 타입 및 인터페이스 정의</title>
<file>src/backup/types.ts</file>
<action>create</action>
<description>
백업 관련 TypeScript 타입 및 인터페이스 정의:
- BackupMetadata: 백업 ID, 타임스탬프, 환경, 워크플로우 수 등
- BackupManifest: 백업 세션의 전체 정보 (메타데이터 + 워크플로우 목록)
- BackupOptions: 백업 실행 옵션 (출력 디렉토리, credentials 포함 여부 등)
- BackupResult: 백업 결과 (성공/실패, 경로, 통계)
</description>
</task>

<task id="2">
<title>백업 저장소 유틸리티 구현</title>
<file>src/backup/storage.ts</file>
<action>create</action>
<description>
백업 저장소 관리 유틸리티 함수:
- generateBackupId(): 타임스탬프 기반 고유 백업 ID 생성 (YYYYMMDD_HHmmss 형식)
- createBackupDirectory(baseDir, backupId): 백업 디렉토리 생성
- writeManifest(backupDir, manifest): 매니페스트 JSON 파일 저장
- readManifest(backupDir): 매니페스트 파일 읽기
- listBackups(baseDir): 기존 백업 목록 조회
- getLatestBackup(baseDir): 가장 최근 백업 정보 조회
</description>
</task>

<task id="3">
<title>백업 모듈 인덱스 설정</title>
<file>src/backup/index.ts</file>
<action>create</action>
<description>
백업 모듈 공개 API 정의:
- types.ts에서 모든 타입 재내보내기
- storage.ts에서 유틸리티 함수 재내보내기
</description>
</task>

<task id="4">
<title>설정 파일에 백업 설정 추가</title>
<file>src/types/config.ts</file>
<action>modify</action>
<description>
N8nWfmConfig 인터페이스에 백업 설정 추가:
- backup.baseDir: 백업 기본 디렉토리 (기본값: ./backups)
- backup.retention: 백업 보관 개수 (기본값: 10)
- backup.stripCredentials: credentials 제거 여부 (기본값: true)
</description>
</task>

<task id="5">
<title>빌드 검증</title>
<file>package.json</file>
<action>verify</action>
<description>
npm run build 실행하여 타입 에러 없이 빌드되는지 확인
</description>
</task>

## Verification
- [ ] `npm run build` 성공
- [ ] BackupMetadata, BackupManifest 타입 정의 완료
- [ ] storage 유틸리티 함수들 구현 완료
- [ ] 설정 파일에 backup 섹션 추가됨

## Notes
- 기존 export 모듈의 ExportResult 타입을 백업에서도 활용
- 백업 디렉토리 구조: `{baseDir}/{backupId}/` 하위에 워크플로우 JSON 파일들
- 매니페스트 파일: `{backupDir}/manifest.json`
