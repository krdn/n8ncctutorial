# Plan 04-03: 스케줄 백업 (cron 연동)

## Overview
자동화된 스케줄 백업을 위한 cron 표현식 지원과 백업 보관 정책(retention)을 구현합니다. 시스템 cron과 연동할 수 있는 형태로 구성합니다.

## Dependencies
- 04-01 완료 (백업 저장소 구조)
- 04-02 완료 (수동 백업 명령어)

## Tasks

<task id="1">
<title>백업 보관 정책 구현</title>
<file>src/backup/retention.ts</file>
<action>create</action>
<description>
백업 보관(retention) 관리 로직:
- cleanupOldBackups(baseDir, keepCount): 오래된 백업 삭제
  - 백업 목록을 날짜순 정렬
  - keepCount 개수 초과 시 오래된 것부터 삭제
  - 삭제된 백업 목록 반환
- getBackupStats(baseDir): 백업 통계 조회
  - 전체 백업 수, 총 용량, 가장 오래된/최신 백업 날짜
</description>
</task>

<task id="2">
<title>스케줄 백업 설정 타입 추가</title>
<file>src/backup/types.ts</file>
<action>modify</action>
<description>
스케줄 관련 타입 추가:
- ScheduleConfig: cron 표현식, 활성화 여부
- BackupOptions에 retention 옵션 추가
</description>
</task>

<task id="3">
<title>backup 명령어에 retention 옵션 추가</title>
<file>src/cli/commands/backup.ts</file>
<action>modify</action>
<description>
backup 명령어에 옵션 추가:
- --retention <count>: 보관할 백업 개수 (0이면 무제한)
- --cleanup: 백업 후 retention 정책 적용
백업 완료 후 자동으로 오래된 백업 정리
</description>
</task>

<task id="4">
<title>cron 스케줄 정보 출력 명령어</title>
<file>src/cli/commands/backup.ts</file>
<action>modify</action>
<description>
backup 하위 명령어 추가:
- `n8n-wfm backup cron-example`: 시스템 cron 설정 예시 출력
  - crontab -e로 추가할 라인 예시
  - 일반적인 스케줄 패턴 (매일, 매주, 매시간)
  - 로그 파일 설정 방법
</description>
</task>

<task id="5">
<title>백업 모듈 인덱스 업데이트</title>
<file>src/backup/index.ts</file>
<action>modify</action>
<description>
retention.ts 함수들 재내보내기:
- cleanupOldBackups, getBackupStats
</description>
</task>

<task id="6">
<title>빌드 및 CLI 검증</title>
<file>package.json</file>
<action>verify</action>
<description>
- npm run build 실행
- node dist/index.js backup --help에서 retention 옵션 확인
- node dist/index.js backup cron-example 실행 확인
</description>
</task>

## Verification
- [ ] `npm run build` 성공
- [ ] `node dist/index.js backup --help`에 --retention, --cleanup 옵션 표시
- [ ] `node dist/index.js backup cron-example` 실행 시 cron 설정 예시 출력
- [ ] cleanupOldBackups 함수 구현 완료

## Notes
- 내장 스케줄러 대신 시스템 cron 활용 (간단하고 안정적)
- retention은 백업 개수 기준 (날짜 기준은 향후 확장 가능)
- cron-example은 사용자가 쉽게 설정할 수 있도록 가이드 제공
- 예시 cron: `0 2 * * * cd /path/to/project && n8n-wfm backup --cleanup >> /var/log/n8n-backup.log 2>&1`
