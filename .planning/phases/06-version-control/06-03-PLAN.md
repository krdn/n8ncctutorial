---
phase: 06-version-control
plan: 03
type: execute
depends_on: ["06-02"]
files_modified: [src/version/commit.ts, src/version/types.ts, src/version/index.ts, src/cli/commands/version.ts]
---

<objective>
자동 커밋 및 변경 이력 관리 기능을 구현합니다.

Purpose: 백업 시 자동으로 Git 커밋하여 워크플로우 버전 이력 추적
Output: 자동 커밋 함수, 변경 이력 조회, CLI commit 명령어
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./06-03-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-version-control/06-01-SUMMARY.md
@.planning/phases/06-version-control/06-02-SUMMARY.md

# 참조 파일:
@src/version/git.ts
@src/version/watch.ts
@src/version/types.ts

**기술 스택:**
- TypeScript 5.x, ES Modules
- simple-git

**결정 사항:**
- 커밋 메시지 자동 생성: 변경된 워크플로우 수 기반
- 백업 명령어에 --commit 옵션 추가하여 연동
- 커밋 시 author 정보는 Git 설정에서 가져오거나 기본값 사용
</context>

<tasks>

<task type="auto">
  <name>Task 1: 자동 커밋 타입 및 함수 구현</name>
  <files>src/version/commit.ts, src/version/types.ts</files>
  <action>
1. src/version/types.ts에 타입 추가:
   - AutoCommitOptions: message (optional), includeUntracked (default: true)
   - AutoCommitResult: success, hash, message, changedFiles

2. src/version/commit.ts 생성:
   - generateCommitMessage(changes): 변경 내용 기반 커밋 메시지 자동 생성
     - 예: "backup: 3 workflows updated (My Workflow, Test Flow, ...)"
     - 추가/수정/삭제 구분하여 메시지 생성

   - autoCommit(repoPath, options?): 자동 커밋 수행
     - detectChanges()로 변경 감지
     - 변경 없으면 early return (success: true, hash: null)
     - stageFiles()로 스테이징
     - commitChanges()로 커밋
     - AutoCommitResult 반환

   - getHistory(repoPath, options?): 커밋 이력 조회
     - limit: 조회할 개수 (기본 20)
     - workflowId: 특정 워크플로우 관련 커밋만 필터
  </action>
  <verify>npm run build 성공</verify>
  <done>commit.ts 모듈에 자동 커밋 함수 구현 완료</done>
</task>

<task type="auto">
  <name>Task 2: version commit CLI 명령어 추가</name>
  <files>src/cli/commands/version.ts</files>
  <action>
src/cli/commands/version.ts에 commit 하위 명령어 추가:
- `n8n-wfm version commit [path]` - 변경 사항 커밋
  - -m, --message <msg>: 커밋 메시지 (생략 시 자동 생성)
  - --dry-run: 실제 커밋 없이 변경 사항만 표시
  - 커밋 성공 시 해시와 변경 파일 수 출력

version log 명령어 개선:
- --workflow <id>: 특정 워크플로우 관련 커밋만 필터
- 커밋 해시 (7자리), 날짜, 메시지 표시
  </action>
  <verify>
npm run build 성공
node dist/index.js version commit --help 출력 확인
  </verify>
  <done>version commit CLI 명령어 구현, log 명령어 개선</done>
</task>

<task type="auto">
  <name>Task 3: version 모듈 인덱스 업데이트</name>
  <files>src/version/index.ts</files>
  <action>
src/version/index.ts 수정:
- commit.ts에서 함수 재내보내기:
  - generateCommitMessage
  - autoCommit
  - getHistory
- 새 타입 재내보내기:
  - AutoCommitOptions
  - AutoCommitResult
  </action>
  <verify>npm run build 성공</verify>
  <done>version 모듈 인덱스에 커밋 관련 함수 추가</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] `node dist/index.js version commit --help` 정상 출력
- [ ] autoCommit 함수 구현 완료
- [ ] 커밋 메시지 자동 생성 로직 구현
- [ ] getHistory 함수로 커밋 이력 조회 가능
</verification>

<success_criteria>
- 자동 커밋 기능 구현됨
- 커밋 메시지 자동 생성 (변경 워크플로우 정보 포함)
- version commit CLI 명령어 동작
- 빌드 성공
</success_criteria>

<output>
완료 후 `.planning/phases/06-version-control/06-03-SUMMARY.md` 생성
</output>
