---
phase: 06-version-control
plan: 01
type: execute
depends_on: []
files_modified: [src/version/types.ts, src/version/git.ts, src/version/index.ts, src/cli/commands/version.ts, src/cli/commands/index.ts]
---

<objective>
Git 저장소 초기화 및 기본 연동 기능을 구현합니다.

Purpose: 워크플로우 버전 관리를 위한 Git 기반 인프라 구축
Output: Git 저장소 초기화, 상태 확인, 커밋 기능을 제공하는 version 모듈과 CLI 명령어
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./06-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# 참조 모듈 (기존 패턴):
@src/backup/storage.ts
@src/backup/types.ts
@src/cli/commands/backup.ts

**기술 스택:**
- TypeScript 5.x, ES Modules
- Node.js 20+ (native fetch)
- Commander.js CLI
- simple-git 라이브러리 (Git 작업용)

**결정 사항:**
- simple-git 사용: Node.js 환경에서 가장 널리 사용되는 Git 라이브러리
- 워크플로우 백업 디렉토리를 Git 저장소로 관리
- .gitignore에 민감 정보(credentials) 패턴 추가
</context>

<tasks>

<task type="auto">
  <name>Task 1: simple-git 설치 및 버전 관리 타입 정의</name>
  <files>package.json, src/version/types.ts</files>
  <action>
1. simple-git 패키지 설치: `npm install simple-git`
2. src/version/types.ts 생성:
   - GitConfig: repoPath (저장소 경로)
   - GitStatus: isRepo, branch, isClean, staged, modified, untracked, ahead, behind
   - CommitOptions: message, author (optional)
   - CommitResult: hash, branch, summary
   - VersionControlConfig: 설정 파일용 Git 설정 타입
  </action>
  <verify>npm ls simple-git로 설치 확인, TypeScript 컴파일 성공</verify>
  <done>simple-git 설치됨, version/types.ts에 타입 정의 완료</done>
</task>

<task type="auto">
  <name>Task 2: Git 연동 모듈 구현</name>
  <files>src/version/git.ts</files>
  <action>
src/version/git.ts 생성 - simple-git 래핑 함수들:
- initRepo(repoPath): Git 저장소 초기화 (.gitignore 자동 생성 포함)
- isGitRepo(repoPath): Git 저장소 여부 확인
- getRepoStatus(repoPath): 현재 상태 조회 (GitStatus 반환)
- stageFiles(repoPath, files): 파일 스테이징 (files가 빈 배열이면 전체)
- commitChanges(repoPath, options): 변경 사항 커밋
- getCommitLog(repoPath, limit?): 최근 커밋 이력 조회

주의사항:
- simpleGit() 인스턴스 생성 시 baseDir 옵션 사용
- 에러 처리: GitError 커스텀 에러 클래스 생성
- 한글 파일명 지원을 위해 core.quotepath false 설정
  </action>
  <verify>npm run build 성공</verify>
  <done>git.ts 모듈에 Git 연동 함수 구현 완료</done>
</task>

<task type="auto">
  <name>Task 3: version 모듈 인덱스 및 CLI 명령어 구현</name>
  <files>src/version/index.ts, src/cli/commands/version.ts, src/cli/commands/index.ts</files>
  <action>
1. src/version/index.ts 생성:
   - types.ts에서 타입 재내보내기
   - git.ts에서 함수 재내보내기

2. src/cli/commands/version.ts 생성:
   - `n8n-wfm version init [path]` - Git 저장소 초기화
     - 기본 경로: 설정 파일의 backup.directory
     - --force: 기존 저장소 재초기화
   - `n8n-wfm version status` - 저장소 상태 확인
     - 브랜치, staged/modified/untracked 파일 수 표시
   - `n8n-wfm version log [--limit N]` - 커밋 이력 조회
     - 기본 10개, --limit으로 조정

3. src/cli/commands/index.ts 수정:
   - registerVersionCommand 추가
  </action>
  <verify>
npm run build 성공
node dist/index.js version --help 출력 확인
node dist/index.js version init --help 출력 확인
  </verify>
  <done>version CLI 명령어 등록 및 init/status/log 하위 명령어 구현</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] `node dist/index.js version --help` 정상 출력
- [ ] `node dist/index.js version init --help` 정상 출력
- [ ] `node dist/index.js version status --help` 정상 출력
- [ ] simple-git 패키지 설치 확인
</verification>

<success_criteria>
- simple-git 패키지 설치됨
- version 모듈 타입 및 Git 연동 함수 구현됨
- version CLI 명령어 (init, status, log) 구현됨
- 빌드 성공, CLI 도움말 출력 정상
</success_criteria>

<output>
완료 후 `.planning/phases/06-version-control/06-01-SUMMARY.md` 생성
</output>
