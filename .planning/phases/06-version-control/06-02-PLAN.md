---
phase: 06-version-control
plan: 02
type: execute
depends_on: ["06-01"]
files_modified: [src/version/watch.ts, src/version/types.ts, src/version/index.ts]
---

<objective>
워크플로우 변경 감지 기능을 구현합니다.

Purpose: 백업 디렉토리 내 워크플로우 JSON 파일의 변경을 감지하여 버전 관리 자동화 지원
Output: 변경 감지 함수 및 워크플로우 비교 유틸리티
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./06-02-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-version-control/06-01-SUMMARY.md

# 참조 파일:
@src/version/git.ts
@src/version/types.ts
@src/backup/storage.ts

**기술 스택:**
- TypeScript 5.x, ES Modules
- simple-git (getRepoStatus 활용)
- Node.js fs 모듈

**결정 사항:**
- Git status 기반 변경 감지 (modified, untracked 파일 목록)
- 워크플로우 JSON 구조 비교 시 ID, 이름, 노드 수준에서 차이 요약
</context>

<tasks>

<task type="auto">
  <name>Task 1: 변경 감지 타입 확장</name>
  <files>src/version/types.ts</files>
  <action>
src/version/types.ts에 변경 감지 관련 타입 추가:
- WorkflowChange: workflowId, workflowName, filePath, changeType ('added' | 'modified' | 'deleted')
- ChangeDetectionResult: changes (WorkflowChange[]), hasChanges, timestamp
- WorkflowDiff: 워크플로우 간 차이점 요약 (노드 추가/삭제/수정, 연결 변경 등)
  </action>
  <verify>npm run build 성공</verify>
  <done>변경 감지 관련 타입 정의 완료</done>
</task>

<task type="auto">
  <name>Task 2: 변경 감지 모듈 구현</name>
  <files>src/version/watch.ts</files>
  <action>
src/version/watch.ts 생성:
- detectChanges(repoPath): Git status 기반 변경 감지
  - getRepoStatus() 호출로 modified, untracked 파일 목록 획득
  - .json 파일만 필터링 (워크플로우 파일)
  - 매니페스트 파일(manifest.json)은 제외
  - WorkflowChange 배열로 변환하여 반환

- parseWorkflowFromFile(filePath): 워크플로우 JSON 파일 읽기
  - 파일 존재 여부 확인
  - JSON 파싱 및 기본 검증

- getWorkflowSummary(workflow): 워크플로우 요약 정보
  - ID, 이름, 노드 개수, 활성화 상태 반환

주의사항:
- 파일이 삭제된 경우 (deleted) Git status에서 감지
- 대소문자 구분 문제 방지를 위해 경로 정규화
  </action>
  <verify>npm run build 성공</verify>
  <done>watch.ts 모듈에 변경 감지 함수 구현 완료</done>
</task>

<task type="auto">
  <name>Task 3: version 모듈 인덱스 업데이트</name>
  <files>src/version/index.ts</files>
  <action>
src/version/index.ts 수정:
- watch.ts에서 함수 재내보내기:
  - detectChanges
  - parseWorkflowFromFile
  - getWorkflowSummary
- types.ts에서 새 타입 재내보내기:
  - WorkflowChange
  - ChangeDetectionResult
  </action>
  <verify>npm run build 성공, TypeScript 타입 export 확인</verify>
  <done>version 모듈 인덱스에 변경 감지 함수 추가</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] detectChanges 함수 구현 완료
- [ ] WorkflowChange, ChangeDetectionResult 타입 export 확인
- [ ] JSON 파일 파싱 및 워크플로우 요약 함수 구현
</verification>

<success_criteria>
- 변경 감지 타입 및 함수 구현됨
- Git status 기반 변경된 워크플로우 파일 목록 반환
- 빌드 성공
</success_criteria>

<output>
완료 후 `.planning/phases/06-version-control/06-02-SUMMARY.md` 생성
</output>
