---
phase: 08-deployment-core
plan: 01
type: execute
depends_on: []
files_modified: [src/deploy/types.ts, src/deploy/pipeline.ts, src/deploy/index.ts]
---

<objective>
배포 파이프라인 핵심 타입과 기본 구조를 설계합니다.

Purpose: 배포 작업의 타입 안전성 확보 및 파이프라인 기반 설계
Output: 배포 관련 타입 정의, 파이프라인 인터페이스, 기본 모듈 구조
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./08-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-environment-config/07-03-SUMMARY.md

# 참조 파일:
@src/types/config.ts
@src/types/n8n.ts
@src/config/credentials.ts
@src/workflow/export.ts
@src/workflow/import.ts

**기술 스택:**
- TypeScript 5.x, ES Modules
- 기존 export/import 모듈 재사용
- credential 매핑 시스템 활용

**배경:**
- 배포 = 소스 환경에서 워크플로우 export → credential 변환 → 대상 환경으로 import
- 단일 워크플로우 배포, 다중 워크플로우 배포, 전체 배포 지원
- 배포 전 검증, 배포 후 확인, 롤백 지원 필요

**결정 사항:**
- 파이프라인 패턴: validate → prepare → transform → deploy → verify
- 배포 결과는 상세 리포트 형태로 반환
- 배포 이력 저장 (향후 롤백 지원)
</context>

<tasks>

<task type="auto">
  <name>Task 1: 배포 타입 정의</name>
  <files>src/deploy/types.ts</files>
  <action>
src/deploy/types.ts 생성:

1. DeploymentTarget 인터페이스:
   - sourceEnv: string (소스 환경 이름)
   - targetEnv: string (대상 환경 이름)
   - workflowIds?: string[] (특정 워크플로우만 배포, 없으면 전체)

2. DeploymentOptions 인터페이스:
   - dryRun: boolean (시뮬레이션 모드)
   - skipValidation: boolean (검증 생략)
   - activateAfterDeploy: boolean (배포 후 활성화)
   - overwrite: boolean (기존 워크플로우 덮어쓰기)
   - createBackup: boolean (배포 전 대상 환경 백업)

3. DeploymentResult 인터페이스:
   - success: boolean
   - timestamp: string (ISO 형식)
   - sourceEnv: string
   - targetEnv: string
   - workflows: DeployedWorkflow[]
   - summary: DeploymentSummary
   - errors: DeploymentError[]

4. DeployedWorkflow 인터페이스:
   - workflowId: string (원본 ID)
   - workflowName: string
   - targetId: string (대상 환경의 ID)
   - action: 'created' | 'updated' | 'skipped'
   - credentialsTransformed: number

5. DeploymentSummary 인터페이스:
   - total: number
   - created: number
   - updated: number
   - skipped: number
   - failed: number

6. DeploymentError 인터페이스:
   - workflowId: string
   - workflowName: string
   - phase: 'validation' | 'transform' | 'deploy' | 'verify'
   - message: string

7. DEFAULT_DEPLOYMENT_OPTIONS 상수 내보내기
  </action>
  <verify>npm run build 성공</verify>
  <done>배포 타입 정의</done>
</task>

<task type="auto">
  <name>Task 2: 파이프라인 기본 구조</name>
  <files>src/deploy/pipeline.ts</files>
  <action>
src/deploy/pipeline.ts 생성:

1. DeploymentPipeline 클래스:
   - constructor(sourceClient, targetClient, config)
   - 프로퍼티: sourceClient, targetClient, config

2. 파이프라인 단계 메서드 스텁:
   - async validate(target: DeploymentTarget): Promise<ValidationResult>
     - 소스/대상 환경 존재 확인
     - 워크플로우 ID 유효성 확인
     - credential 매핑 검증

   - async prepare(target: DeploymentTarget): Promise<PrepareResult>
     - 배포 대상 워크플로우 목록 조회
     - credential 변환 맵 생성 (buildCredentialTransform 활용)

   - async transformCredentials(workflow, transform): Promise<N8nWorkflowDetail>
     - 워크플로우 내 credential ID 변환

   - async deploy(workflow, options): Promise<DeployedWorkflow>
     - 단일 워크플로우 배포 실행

   - async verify(workflowId): Promise<boolean>
     - 배포된 워크플로우 존재 확인

3. PrepareResult 타입:
   - workflows: N8nWorkflowDetail[]
   - credentialTransform: CredentialTransform

4. runPipeline(target, options): Promise<DeploymentResult>
   - 전체 파이프라인 실행 조율
   - 각 단계 실행 및 에러 수집
   - 최종 DeploymentResult 반환
  </action>
  <verify>npm run build 성공</verify>
  <done>파이프라인 기본 구조</done>
</task>

<task type="auto">
  <name>Task 3: 모듈 인덱스 및 내보내기</name>
  <files>src/deploy/index.ts</files>
  <action>
src/deploy/index.ts 생성:

1. types.ts에서 타입 재내보내기:
   - DeploymentTarget
   - DeploymentOptions
   - DeploymentResult
   - DeployedWorkflow
   - DeploymentSummary
   - DeploymentError
   - DEFAULT_DEPLOYMENT_OPTIONS

2. pipeline.ts에서 클래스/함수 재내보내기:
   - DeploymentPipeline

3. 빌드 검증
  </action>
  <verify>
npm run build 성공
import { DeploymentPipeline } from './deploy' 사용 가능
  </verify>
  <done>배포 모듈 기본 구조 완성</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] `DeploymentTarget`, `DeploymentOptions`, `DeploymentResult` 타입 정의됨
- [ ] `DeploymentPipeline` 클래스 생성됨
- [ ] 파이프라인 단계 메서드 (validate, prepare, transform, deploy, verify) 스텁 존재
- [ ] `src/deploy/index.ts`에서 모듈 재내보내기 완료
</verification>

<success_criteria>
- 배포 관련 모든 타입이 정의됨
- 파이프라인 패턴 기본 구조 수립
- 08-02, 08-03에서 구현할 기반 완성
</success_criteria>

<output>
완료 후 `.planning/phases/08-deployment-core/08-01-SUMMARY.md` 생성
</output>
