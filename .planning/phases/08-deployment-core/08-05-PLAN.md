---
phase: 08-deployment-core
plan: 05
type: execute
depends_on: ["08-02", "08-03", "08-04"]
files_modified: [src/cli/commands/deploy.ts, src/cli/commands/index.ts]
---

<objective>
배포 CLI 명령어를 구현합니다.

Purpose: 명령줄에서 환경 간 워크플로우 배포 실행
Output: deploy 명령어 그룹 (deploy, deploy status, deploy rollback)
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./08-05-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-deployment-core/08-01-PLAN.md
@.planning/phases/08-deployment-core/08-04-PLAN.md

# 참조 파일:
@src/cli/commands/env.ts (환경 전환 명령 패턴)
@src/cli/commands/backup.ts (backup 명령 패턴)
@src/deploy/index.ts
@src/config/index.ts

**기술 스택:**
- TypeScript 5.x, ES Modules
- Commander.js CLI 프레임워크
- chalk 컬러 출력

**배경:**
- 배포는 프로젝트 핵심 가치 (Core Value)
- 직관적인 CLI 인터페이스로 쉬운 배포 경험
- dry-run 모드로 안전한 사전 확인

**결정 사항:**
- n8n-wfm deploy <source> <target> [options]
- n8n-wfm deploy status (배포 이력)
- n8n-wfm deploy rollback [deployment-id]
</context>

<tasks>

<task type="auto">
  <name>Task 1: deploy 기본 명령어</name>
  <files>src/cli/commands/deploy.ts</files>
  <action>
src/cli/commands/deploy.ts 생성:

1. import 문:
   - commander (Command)
   - chalk
   - 설정 로더 (loadConfig, getCurrentEnvironment)
   - API 클라이언트 (createClientFromConfig)
   - 배포 모듈 (DeploymentPipeline, DEFAULT_DEPLOYMENT_OPTIONS)

2. registerDeployCommand(program: Command): void

3. deploy 명령어:
   - `deploy <source> <target>`
   - 설명: "워크플로우를 소스 환경에서 대상 환경으로 배포"

   옵션:
   - `--config <path>`: 설정 파일 경로
   - `--workflows <ids>`: 특정 워크플로우 ID (쉼표 구분)
   - `--dry-run`: 시뮬레이션 모드 (실제 배포 없음)
   - `--no-backup`: 배포 전 백업 생략
   - `--activate`: 배포 후 워크플로우 활성화
   - `--force`: 기존 워크플로우 강제 덮어쓰기

4. 실행 로직:
   - 설정 로드
   - 소스/대상 환경 검증
   - API 클라이언트 생성 (소스용, 대상용)
   - DeploymentPipeline 인스턴스 생성
   - runPipeline 실행
   - 결과 출력 (성공/실패 워크플로우, 통계)

5. 출력 형식:
   - dry-run 모드: "[DRY-RUN]" 표시
   - 진행 상황: "워크플로우 배포 중..."
   - 결과 테이블: ID, 이름, 작업(created/updated), 상태
   - 요약: 전체 N개, 성공 N개, 실패 N개
  </action>
  <verify>npm run build 성공</verify>
  <done>deploy 기본 명령어</done>
</task>

<task type="auto">
  <name>Task 2: deploy status 및 rollback 명령어</name>
  <files>src/cli/commands/deploy.ts</files>
  <action>
src/cli/commands/deploy.ts에 추가:

1. deploy status 서브커맨드:
   - `deploy status`
   - 설명: "배포 이력 조회"

   옵션:
   - `--limit <n>`: 표시할 최대 개수 (기본: 10)
   - `--env <name>`: 특정 환경 필터

   출력:
   - 배포 ID, 시간, 소스→대상, 워크플로우 수, 상태
   - 최근 배포부터 역순 정렬

2. deploy rollback 서브커맨드:
   - `deploy rollback [deployment-id]`
   - 설명: "이전 배포 상태로 롤백"

   옵션:
   - `--config <path>`: 설정 파일 경로
   - `--workflows <ids>`: 특정 워크플로우만 롤백

   동작:
   - deployment-id 없으면 가장 최근 배포 롤백
   - 확인 프롬프트 출력 (--yes로 생략 가능)
   - 롤백 실행 및 결과 출력

3. deploy diff 서브커맨드 (선택):
   - `deploy diff <source> <target>`
   - 소스와 대상 환경 간 워크플로우 차이 비교
   - 배포 전 확인용
  </action>
  <verify>npm run build 성공</verify>
  <done>deploy status 및 rollback 명령어</done>
</task>

<task type="auto">
  <name>Task 3: CLI 통합 및 검증</name>
  <files>src/cli/commands/index.ts</files>
  <action>
1. src/cli/commands/index.ts 수정:
   - import { registerDeployCommand } from './deploy.js'
   - registerDeployCommand(program) 호출 추가

2. 빌드 검증

3. CLI 명령어 테스트:
   - node dist/index.js deploy --help
   - node dist/index.js deploy status --help
   - node dist/index.js deploy rollback --help

4. 도움말 텍스트 확인:
   - 명령어 설명 명확한지
   - 옵션 설명 충분한지
   - 사용 예시 포함
  </action>
  <verify>
npm run build 성공
node dist/index.js deploy --help 정상 출력
node dist/index.js deploy status --help 정상 출력
  </verify>
  <done>배포 CLI 완성, Phase 8 완료</done>
</task>

</tasks>

<verification>
- [ ] `npm run build` 성공
- [ ] `n8n-wfm deploy <source> <target>` 명령어 동작
- [ ] `n8n-wfm deploy status` 배포 이력 표시
- [ ] `n8n-wfm deploy rollback` 롤백 기능 동작
- [ ] `--dry-run` 옵션으로 시뮬레이션 가능
- [ ] 결과 출력이 명확하고 가독성 좋음
- [ ] Phase 8 Deployment Core 완료
</verification>

<success_criteria>
- 직관적인 배포 CLI 인터페이스
- dry-run으로 안전한 사전 확인
- 배포 이력 조회 및 롤백 지원
- Phase 8 전체 완료
</success_criteria>

<output>
완료 후 `.planning/phases/08-deployment-core/08-05-SUMMARY.md` 생성
</output>

<phase_completion>
Phase 8 완료 시:
- ROADMAP.md Phase 8 체크박스 완료 처리
- Phase 8 모든 플랜 완료 표시
- 진행률 테이블 업데이트
</phase_completion>
