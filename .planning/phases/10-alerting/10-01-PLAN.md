---
phase: 10-alerting
plan: 01
type: execute
depends_on: []
files_modified: [src/alert/types.ts, src/alert/channels/slack.ts, src/alert/channels/webhook.ts, src/alert/channels/email.ts, src/alert/channels/index.ts, src/alert/index.ts, src/types/config.ts, src/config/schema.ts]
---

<objective>
알림 채널 설정 기반 구축 - Slack, Email, Webhook 알림 전송 기능 구현

Purpose: 워크플로우 오류 발생 시 다양한 채널로 알림을 보낼 수 있는 기반 구조 마련
Output: src/alert/ 모듈, Config 타입에 alerts 섹션 추가, 채널별 알림 전송 함수
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-monitoring/09-01-SUMMARY.md

**기존 모듈 참조:**
@src/monitor/types.ts
@src/monitor/executions.ts
@src/types/config.ts
@src/config/schema.ts

**Tech stack available:**
- native fetch (Node.js 20+)
- 추가 의존성 최소화 (nodemailer 미사용, SMTP는 직접 구현하거나 선택적으로 추가)

**Established patterns:**
- 타입 정의 → 함수 구현 → index.ts export 패턴
- Config 인터페이스 확장 및 스키마 검증 패턴

**Constraining decisions:**
- Phase 9: 모니터링 모듈에서 ExecutionFilter, ExecutionSummary 타입 사용 가능
- CLI 프로젝트이므로 단순 HTTP 기반 알림 (Slack Webhook, 일반 Webhook)
</context>

<tasks>

<task type="auto">
  <name>Task 1: 알림 타입 정의 및 Config 확장</name>
  <files>src/alert/types.ts, src/types/config.ts, src/config/schema.ts</files>
  <action>
1. src/alert/types.ts 생성:
   - AlertChannelType: 'slack' | 'email' | 'webhook'
   - AlertSeverity: 'info' | 'warning' | 'error' | 'critical'
   - AlertMessage: 알림 내용 인터페이스 (title, message, severity, workflowId?, executionId?, timestamp)
   - AlertResult: 전송 결과 (success, channel, error?)
   - SlackChannelConfig: webhookUrl 필수
   - EmailChannelConfig: smtp 설정 (host, port, secure, auth?, from, to)
   - WebhookChannelConfig: url, method?, headers?
   - AlertChannelConfig: type + (slack | email | webhook 설정) union
   - AlertConfig: channels 배열, enabled 플래그

2. src/types/config.ts 수정:
   - Config 인터페이스에 alerts?: AlertConfig 추가

3. src/config/schema.ts 수정:
   - validateAlertConfig 함수 추가
   - validateConfig에 alerts 검증 로직 추가
  </action>
  <verify>npm run build 성공, 타입 정의 파일 존재 확인</verify>
  <done>AlertMessage, AlertChannelConfig, AlertConfig 타입 정의됨, Config에 alerts 필드 추가됨, 스키마 검증 통과</done>
</task>

<task type="auto">
  <name>Task 2: 알림 채널 전송 함수 구현</name>
  <files>src/alert/channels/slack.ts, src/alert/channels/webhook.ts, src/alert/channels/email.ts, src/alert/channels/index.ts</files>
  <action>
1. src/alert/channels/slack.ts:
   - sendSlackAlert(config: SlackChannelConfig, message: AlertMessage): Promise<AlertResult>
   - Slack Webhook API 포맷으로 메시지 변환 (blocks 또는 attachments 사용)
   - 색상: info=blue, warning=yellow, error=red, critical=darkred
   - native fetch 사용

2. src/alert/channels/webhook.ts:
   - sendWebhookAlert(config: WebhookChannelConfig, message: AlertMessage): Promise<AlertResult>
   - 범용 webhook 전송 (POST 기본, JSON body)
   - custom headers 지원

3. src/alert/channels/email.ts:
   - sendEmailAlert(config: EmailChannelConfig, message: AlertMessage): Promise<AlertResult>
   - net.createConnection으로 간단한 SMTP 전송 구현 (선택: 외부 라이브러리 없이)
   - 또는 단순 로그 출력 + 향후 확장 가능 구조로 placeholder 구현
   - SMTP 연동이 복잡하므로, 기본은 console.warn으로 "Email alert not fully implemented" 출력 후 success: false 반환

4. src/alert/channels/index.ts:
   - 모든 채널 함수 re-export
  </action>
  <verify>npm run build 성공</verify>
  <done>Slack, Webhook 알림 전송 가능, Email은 placeholder 구현</done>
</task>

<task type="auto">
  <name>Task 3: 알림 모듈 통합 및 sendAlert 함수</name>
  <files>src/alert/send.ts, src/alert/index.ts</files>
  <action>
1. src/alert/send.ts:
   - sendAlert(config: AlertChannelConfig, message: AlertMessage): Promise<AlertResult>
     - config.type에 따라 적절한 채널 함수 호출
   - sendAlerts(configs: AlertChannelConfig[], message: AlertMessage): Promise<AlertResult[]>
     - 모든 설정된 채널에 알림 전송 (Promise.all)
   - formatAlertMessage(message: AlertMessage): string
     - 콘솔/로그용 포맷팅 헬퍼

2. src/alert/index.ts:
   - 모든 타입 re-export (from './types.js')
   - 모든 채널 함수 re-export (from './channels/index.js')
   - sendAlert, sendAlerts, formatAlertMessage re-export (from './send.js')
  </action>
  <verify>npm run build 성공, src/alert/index.ts에서 모든 export 확인</verify>
  <done>sendAlert() 함수로 설정 기반 알림 전송 가능</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] src/alert/ 디렉토리에 types.ts, channels/, send.ts, index.ts 존재
- [ ] src/types/config.ts에 alerts?: AlertConfig 필드 있음
- [ ] src/config/schema.ts에 alerts 검증 로직 있음
- [ ] TypeScript 에러 없음
</verification>

<success_criteria>
- 알림 타입 체계 확립 (AlertMessage, AlertChannelConfig, AlertConfig)
- Slack Webhook 알림 전송 함수 동작
- 범용 Webhook 알림 전송 함수 동작
- Config에 alerts 설정 추가 가능
- 모듈 진입점 (src/alert/index.ts) 완성
</success_criteria>

<output>
After completion, create `.planning/phases/10-alerting/10-01-SUMMARY.md`
</output>
