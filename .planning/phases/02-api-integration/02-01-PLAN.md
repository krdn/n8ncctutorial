---
phase: 02-api-integration
plan: 01
type: execute
depends_on: []
files_modified: [src/types/n8n.ts, src/api/client.ts, src/api/index.ts]
---

<objective>
n8n API 타입 정의 및 HTTP 클라이언트 기반 구축

Purpose: n8n REST API와 통신하기 위한 타입 안전한 클라이언트 기반을 구축한다.
Output: n8n API 응답 타입, HTTP 클라이언트 클래스, API 에러 처리
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

**Tech stack available:**
- TypeScript 5.x (ES Modules)
- Node.js 20+ (native fetch 지원)
- 설정 시스템: Config, EnvironmentConfig, N8nInstanceConfig

**n8n API 정보:**
- n8n REST API v1 (https://docs.n8n.io/api/)
- 인증: X-N8N-API-KEY 헤더
- 주요 엔드포인트: /workflows, /executions, /credentials

**Project constraints:**
- n8n MCP 서버 연동 예정이지만, 직접 REST API 호출도 필요
- native fetch 사용 (추가 라이브러리 없음)
</context>

<tasks>

<task type="auto">
  <name>Task 1: n8n API 응답 타입 정의</name>
  <files>src/types/n8n.ts</files>
  <action>
src/types/n8n.ts 생성:

/**
 * n8n Workflow 기본 정보
 */
interface N8nWorkflow {
  id: string;
  name: string;
  active: boolean;
  createdAt: string;
  updatedAt: string;
  tags?: N8nTag[];
}

/**
 * n8n Workflow 상세 정보 (노드 포함)
 */
interface N8nWorkflowDetail extends N8nWorkflow {
  nodes: N8nNode[];
  connections: Record<string, unknown>;
  settings?: Record<string, unknown>;
}

/**
 * n8n Node 정보
 */
interface N8nNode {
  id: string;
  name: string;
  type: string;
  typeVersion: number;
  position: [number, number];
  parameters: Record<string, unknown>;
}

/**
 * n8n Tag 정보
 */
interface N8nTag {
  id: string;
  name: string;
}

/**
 * n8n Execution 정보
 */
interface N8nExecution {
  id: string;
  workflowId: string;
  finished: boolean;
  mode: 'manual' | 'trigger' | 'webhook' | 'cli';
  startedAt: string;
  stoppedAt?: string;
  status: 'success' | 'error' | 'running' | 'waiting';
}

/**
 * n8n API 응답 래퍼
 */
interface N8nApiResponse<T> {
  data: T;
}

/**
 * n8n 워크플로우 목록 응답
 */
interface N8nWorkflowListResponse {
  data: N8nWorkflow[];
  nextCursor?: string;
}

모든 타입을 export
  </action>
  <verify>npm run build (타입 에러 없음)</verify>
  <done>n8n API 관련 타입 정의됨, 빌드 성공</done>
</task>

<task type="auto">
  <name>Task 2: HTTP 클라이언트 클래스 구현</name>
  <files>src/api/client.ts</files>
  <action>
src/api/client.ts 생성:

N8nApiClient 클래스 구현:
- constructor(baseUrl: string, apiKey: string)
- private request<T>(path: string, options?: RequestInit): Promise<T>
  - native fetch 사용
  - X-N8N-API-KEY 헤더 자동 추가
  - Content-Type: application/json
  - 에러 응답 처리 (4xx, 5xx)
  - 타임아웃 설정 (30초)

- async healthCheck(): Promise<boolean>
  - GET /healthz 호출
  - 연결 상태 확인용

- async getWorkflows(): Promise<N8nWorkflow[]>
  - GET /workflows
  - 페이지네이션 처리

- async getWorkflow(id: string): Promise<N8nWorkflowDetail>
  - GET /workflows/{id}

에러 클래스:
- N8nApiError extends Error
  - statusCode: number
  - response?: unknown
  </action>
  <verify>npm run build</verify>
  <done>N8nApiClient 클래스 구현됨, 에러 처리 포함</done>
</task>

<task type="auto">
  <name>Task 3: API 모듈 진입점</name>
  <files>src/api/index.ts</files>
  <action>
src/api/index.ts 생성:

N8nApiClient 클래스와 타입 re-export:
- export { N8nApiClient, N8nApiError } from './client.js';
- export type { ... } from '../types/n8n.js';

createClient 헬퍼 함수:
- createClient(config: EnvironmentConfig): N8nApiClient
- 설정에서 url, apiKey 추출하여 클라이언트 생성
  </action>
  <verify>npm run build</verify>
  <done>API 모듈 진입점 완성, re-export 설정됨</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] src/types/n8n.ts 타입 정의됨
- [ ] N8nApiClient 클래스 구현됨
- [ ] N8nApiError 에러 클래스 구현됨
- [ ] createClient 헬퍼 함수 구현됨
</verification>

<success_criteria>
- 모든 태스크 완료
- n8n API 타입 정의 완성
- HTTP 클라이언트 기반 구축
- 02-02에서 사용 가능한 API 모듈
</success_criteria>

<output>
완료 후 `.planning/phases/02-api-integration/02-01-SUMMARY.md` 생성
</output>
