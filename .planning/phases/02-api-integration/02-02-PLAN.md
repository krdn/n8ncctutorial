---
phase: 02-api-integration
plan: 02
type: execute
depends_on: ["02-01"]
files_modified: [src/api/connection.ts, src/api/index.ts]
---

<objective>
n8n 연결 관리 및 연결 테스트 기능 구현

Purpose: 설정 파일에서 n8n 인스턴스 연결 정보를 로드하고 연결 상태를 테스트하는 기능을 구현한다.
Output: 연결 관리자, 연결 테스트 함수, 연결 상태 타입
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-api-integration/02-01-SUMMARY.md

**Tech stack available:**
- TypeScript 5.x (ES Modules)
- 설정 시스템: loadConfig, getCurrentEnvironment, getEnvironment
- API 클라이언트: N8nApiClient, createClient

**Project constraints:**
- 다중 환경 지원 (dev, staging, prod)
- 연결 실패 시 명확한 에러 메시지
</context>

<tasks>

<task type="auto">
  <name>Task 1: 연결 상태 타입 및 연결 관리자</name>
  <files>src/api/connection.ts</files>
  <action>
src/api/connection.ts 생성:

/**
 * 연결 상태 정보
 */
interface ConnectionStatus {
  connected: boolean;
  environment: string;
  url: string;
  version?: string;
  error?: string;
  latencyMs?: number;
}

/**
 * 연결 테스트 결과
 */
interface ConnectionTestResult {
  success: boolean;
  status: ConnectionStatus;
}

/**
 * 연결 테스트 함수
 * @param client - N8nApiClient 인스턴스
 * @param envName - 환경 이름
 * @returns 연결 테스트 결과
 */
async function testConnection(
  client: N8nApiClient,
  envName: string
): Promise<ConnectionTestResult>

구현 사항:
- healthCheck() 호출하여 연결 확인
- 응답 시간(latency) 측정
- 에러 발생 시 상세 메시지 포함
- ConnectionStatus 객체 반환

/**
 * 설정에서 클라이언트 생성 및 연결 테스트
 */
async function connectToEnvironment(
  envName?: string  // 없으면 currentEnvironment 사용
): Promise<ConnectionTestResult>

구현 사항:
- loadConfig()로 설정 로드
- envName 없으면 getCurrentEnvironment() 사용
- createClient()로 클라이언트 생성
- testConnection() 호출
  </action>
  <verify>npm run build</verify>
  <done>연결 관리자 및 연결 테스트 함수 구현됨</done>
</task>

<task type="auto">
  <name>Task 2: API 모듈 진입점 업데이트</name>
  <files>src/api/index.ts</files>
  <action>
src/api/index.ts 업데이트:

연결 관련 export 추가:
- export { testConnection, connectToEnvironment } from './connection.js';
- export type { ConnectionStatus, ConnectionTestResult } from './connection.js';

기존 export 유지:
- N8nApiClient, N8nApiError, createClient
- n8n API 타입들
  </action>
  <verify>npm run build</verify>
  <done>API 모듈에서 연결 관련 함수 export됨</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` 성공
- [ ] testConnection 함수 구현됨
- [ ] connectToEnvironment 함수 구현됨
- [ ] ConnectionStatus 타입 정의됨
- [ ] API 모듈에서 연결 관련 함수 export됨
</verification>

<success_criteria>
- 모든 태스크 완료
- 연결 테스트 기능 구현
- 다중 환경 연결 지원
- 02-03에서 사용 가능한 연결 모듈
</success_criteria>

<output>
완료 후 `.planning/phases/02-api-integration/02-02-SUMMARY.md` 생성
</output>
